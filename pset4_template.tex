% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={PS4: Spatial Analysis of Rural Hospital Closures by Attaullah Abbasi (attaullahabbasi12)},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{PS4: Spatial Analysis of Rural Hospital Closures by Attaullah
Abbasi (attaullahabbasi12)}
\author{}
\date{}

\begin{document}
\maketitle

\RecustomVerbatimEnvironment{verbatim}{Verbatim}{
  showspaces = false,
  showtabs = false,
  breaksymbolleft={},
  breaklines
}


\textbf{PS4:} Due Sat Nov 2 at 5:00PM Central. Worth 100 points. We use
(\texttt{*}) to indicate a problem that we think might be time
consuming.

\subsection{Style Points (10 pts)}\label{style-points-10-pts}

Please refer to the minilesson on code style
\textbf{\href{https://uchicago.zoom.us/rec/share/pG_wQ-pHTQrJTmqNn4rcrw5V194M2H2s-2jdy8oVhWHkd_yZt9o162IWurpA-fxU.BIQlSgZLRYctvzp-}{here}}.

\subsection{Submission Steps (10 pts)}\label{submission-steps-10-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  This problem set is a paired problem set.
\item
  Play paper, scissors, rock to determine who goes first. Call that
  person \emph{Partner 1}.

  \begin{itemize}
  \tightlist
  \item
    Partner 1 (Attaullah Abbasi and attaullahabbasi):
  \item
    Partner 2 (N/A - assignment completed solo):
  \end{itemize}
\item
  Partner 1 will accept the \texttt{ps4} and then share the link it
  creates with their partner. You can only share it with one partner so
  you will not be able to change it after your partner has accepted.
\item
  ``This submission is our work alone and complies with the 30538
  integrity policy.'' Add your initials to indicate your agreement:
  **\_\_** **\_\_**
\item
  ``I have uploaded the names of anyone else other than my partner and I
  worked with on the problem set
  \textbf{\href{https://docs.google.com/forms/d/185usrCREQaUbvAXpWhChkjghdGgmAZXA3lPWpXLLsts/edit}{here}}''
  (1 point)
\item
  Late coins used this pset: 1 Late coins left after submission: 1
\item
  Knit your \texttt{ps4.qmd} to an PDF file to make \texttt{ps4.pdf},

  \begin{itemize}
  \tightlist
  \item
    The PDF should not be more than 25 pages. Use \texttt{head()} and
    re-size figures when appropriate.
  \end{itemize}
\item
  (Partner 1): push \texttt{ps4.qmd} and \texttt{ps4.pdf} to your github
  repo.
\item
  (Partner 1): submit \texttt{ps4.pdf} via Gradescope. Add your partner
  on Gradescope.
\item
  (Partner 1): tag your submission in Gradescope
\end{enumerate}

\textbf{Important:} Repositories are for tracking code. \textbf{Do not
commit the data or shapefiles to your repo.} The best way to do this is
with \texttt{.gitignore}, which we have covered in class. If you do
accidentally commit the data, Github has a
\href{https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-large-files-on-github\#removing-files-from-a-repositorys-history}{guide}.
The best course of action depends on whether you have pushed yet. This
also means that both partners will have to download the initial raw data
and any data cleaning code will need to be re-run on both partners'
computers.

\subsection{Download and explore the Provider of Services (POS) file (10
pts)}\label{download-and-explore-the-provider-of-services-pos-file-10-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  For the 2016 data, I pulled the following variables:

  \begin{enumerate}
  \def\labelenumii{\roman{enumii}.}
  \tightlist
  \item
    \texttt{PRVDR\_NUM}: Unique CMS certification number for each
    hospital
  \item
    \texttt{FAC\_NAME}: Facility name
  \item
    \texttt{PRVDR\_CTGRY\_CD}: Provider category, to identify hospitals
  \item
    \texttt{PRVDR\_CTGRY\_SBTYP\_CD}: Provider subtype, to identify
    short-term hospitals
  \item
    \texttt{CRTFCTN\_DT}: Certification date, to verify active
    facilities
  \item
    \texttt{ORGNL\_PRTCPTN\_DT}: Original participation date, to confirm
    participation history
  \item
    \texttt{PGM\_TRMNTN\_CD}: Termination code, to track closures
  \item
    \texttt{TRMNTN\_EXPRTN\_DT}: Termination date, to identify closure
    timelines
  \item
    \texttt{ZIP\_CD}: Zip code for geographic analysis
  \item
    \texttt{STATE\_CD}: State abbreviation, useful for filtering Texas
    and nearby states
  \item
    \texttt{CITY\_NAME}: City name for additional geographic context
  \item
    \texttt{ST\_ADR}: Street address for potential geolocation
  \item
    \texttt{CBSA\_URBN\_RRL\_IND}: Urban-rural indicator, helpful for
    understanding location context
  \item
    \texttt{GNRL\_CNTL\_TYPE\_CD}: Control type, to analyze hospital
    ownership
  \end{enumerate}
\end{enumerate}

These variables allow for filtering, spatial analysis, tracking
closures, and understanding hospital characteristics as required by the
problem set.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}

\CommentTok{\# Load the pos2016.csv file}
\NormalTok{data\_2016 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{"pos2016.csv"}\NormalTok{)}

\CommentTok{\# Filter for short{-}term hospitals with provider type code 01 and subtype code 01}
\NormalTok{short\_term\_hospitals\_2016 }\OperatorTok{=}\NormalTok{ data\_2016[(data\_2016[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (data\_2016[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}

\CommentTok{\# a. Count the number of hospitals in this subset}
\NormalTok{hospital\_count\_2016 }\OperatorTok{=}\NormalTok{ short\_term\_hospitals\_2016.shape[}\DecValTok{0}\NormalTok{]}
\NormalTok{hospital\_count\_2016}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
7245
\end{verbatim}

\begin{verbatim}
a.
\end{verbatim}

The dataset reports 7,245 short-term hospitals for 2016.

This count seems high compared to typical figures from industry sources,
such as the American Hospital Association (AHA), which might suggest
differences in data scope or classification criteria used by CMS.

\begin{verbatim}
b.
\end{verbatim}

According to the American Hospital Association (AHA), there were
approximately 5,534 registered hospitals in the U.S. in 2016, with
around 4,840 classified as community hospitals, which includes most
short-term general hospitals. This figure is notably lower than the
7,245 short-term hospitals reported in the CMS dataset.

Reasons for the Discrepancy:

Data Scope: The CMS dataset may include facilities that are
Medicare/Medicaid-certified but not registered with the AHA, potentially
increasing the count.

Different Definitions: CMS may classify certain specialty hospitals or
facilities providing limited services as short-term if they meet
Medicare eligibility criteria, even if other sources don't typically
include them.

Timing and Updates: The dataset represents a Q4 2016 snapshot, while the
AHA's data may reflect closures, mergers, or reclassifications over the
entire year.

These factors could explain the higher count of short-term hospitals in
the CMS dataset compared to other industry sources.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ altair }\ImportTok{as}\NormalTok{ alt}

\CommentTok{\# Load each year\textquotesingle{}s data with appropriate encoding where needed}
\NormalTok{data\_2016 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{"pos2016.csv"}\NormalTok{)}
\NormalTok{data\_2017 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{"pos2017.csv"}\NormalTok{)}
\NormalTok{data\_2018 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{"pos2018.csv"}\NormalTok{, encoding}\OperatorTok{=}\StringTok{"ISO{-}8859{-}1"}\NormalTok{)}
\NormalTok{data\_2019 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{"pos2019.csv"}\NormalTok{, encoding}\OperatorTok{=}\StringTok{"ISO{-}8859{-}1"}\NormalTok{)}

\CommentTok{\# Define a function to filter for short{-}term hospitals}
\KeywordTok{def}\NormalTok{ filter\_short\_term(data):}
    \ControlFlowTok{return}\NormalTok{ data[(data[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (data[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}

\CommentTok{\# Apply filtering to each dataset and add a \textquotesingle{}Year\textquotesingle{} column for each}
\NormalTok{data\_2016 }\OperatorTok{=}\NormalTok{ filter\_short\_term(data\_2016)}
\NormalTok{data\_2016[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2016}

\NormalTok{data\_2017 }\OperatorTok{=}\NormalTok{ filter\_short\_term(data\_2017)}
\NormalTok{data\_2017[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2017}

\NormalTok{data\_2018 }\OperatorTok{=}\NormalTok{ filter\_short\_term(data\_2018)}
\NormalTok{data\_2018[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2018}

\NormalTok{data\_2019 }\OperatorTok{=}\NormalTok{ filter\_short\_term(data\_2019)}
\NormalTok{data\_2019[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2019}

\CommentTok{\# Combine all datasets into a single DataFrame}
\NormalTok{all\_years\_data }\OperatorTok{=}\NormalTok{ pd.concat([data\_2016, data\_2017, data\_2018, data\_2019])}

\CommentTok{\# Count the number of observations (hospitals) by year}
\NormalTok{observations\_by\_year }\OperatorTok{=}\NormalTok{ all\_years\_data.groupby(}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{).size().reset\_index(name}\OperatorTok{=}\StringTok{\textquotesingle{}Count\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Plot using Altair}
\NormalTok{bars }\OperatorTok{=}\NormalTok{ alt.Chart(observations\_by\_year).mark\_bar(color}\OperatorTok{=}\StringTok{\textquotesingle{}steelblue\textquotesingle{}}\NormalTok{).encode(}
\NormalTok{    x}\OperatorTok{=}\NormalTok{alt.X(}\StringTok{\textquotesingle{}Year:O\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{),}
\NormalTok{    y}\OperatorTok{=}\NormalTok{alt.Y(}\StringTok{\textquotesingle{}Count:Q\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{\textquotesingle{}Number of Short{-}Term Hospitals\textquotesingle{}}\NormalTok{)}
\NormalTok{).properties(}
\NormalTok{    title}\OperatorTok{=}\StringTok{\textquotesingle{}Number of Observations in Dataset by Year\textquotesingle{}}\NormalTok{,}
\NormalTok{    width}\OperatorTok{=}\DecValTok{400}\NormalTok{,}
\NormalTok{    height}\OperatorTok{=}\DecValTok{300}
\NormalTok{)}

\CommentTok{\# Add text labels on top of each bar}
\NormalTok{text }\OperatorTok{=}\NormalTok{ bars.mark\_text(}
\NormalTok{    align}\OperatorTok{=}\StringTok{\textquotesingle{}center\textquotesingle{}}\NormalTok{,}
\NormalTok{    baseline}\OperatorTok{=}\StringTok{\textquotesingle{}bottom\textquotesingle{}}\NormalTok{,}
\NormalTok{    dy}\OperatorTok{={-}}\DecValTok{5}  \CommentTok{\# Adjust the position of the text above the bars}
\NormalTok{).encode(}
\NormalTok{    text}\OperatorTok{=}\StringTok{\textquotesingle{}Count:Q\textquotesingle{}}
\NormalTok{)}

\CommentTok{\# Combine the bars and the text}
\NormalTok{(bars }\OperatorTok{+}\NormalTok{ text).display()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
/var/folders/sd/jd56rfvs19gbncmb5yqlmfym0000gn/T/ipykernel_50159/949909169.py:7: DtypeWarning: Columns (13) have mixed types. Specify dtype option on import or set low_memory=False.
  data_2018 = pd.read_csv("pos2018.csv", encoding="ISO-8859-1")
\end{verbatim}

\begin{verbatim}
alt.LayerChart(...)
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \end{enumerate}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ altair }\ImportTok{as}\NormalTok{ alt}

\CommentTok{\# Assuming data for each year is already filtered and loaded}
\CommentTok{\# If not, make sure data\_2016, data\_2017, data\_2018, data\_2019 are loaded and filtered as before}

\CommentTok{\# Add a \textquotesingle{}Year\textquotesingle{} column to each dataset}
\NormalTok{data\_2016[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2016}
\NormalTok{data\_2017[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2017}
\NormalTok{data\_2018[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2018}
\NormalTok{data\_2019[}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2019}

\CommentTok{\# Combine all datasets into a single DataFrame}
\NormalTok{all\_years\_data }\OperatorTok{=}\NormalTok{ pd.concat([data\_2016, data\_2017, data\_2018, data\_2019])}

\CommentTok{\# Count unique hospitals (by PRVDR\_NUM) per year}
\NormalTok{unique\_hospitals\_by\_year }\OperatorTok{=}\NormalTok{ all\_years\_data.groupby(}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{)[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].nunique().reset\_index(name}\OperatorTok{=}\StringTok{\textquotesingle{}UniqueCount\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Plot using Altair}
\NormalTok{bars }\OperatorTok{=}\NormalTok{ alt.Chart(unique\_hospitals\_by\_year).mark\_bar(color}\OperatorTok{=}\StringTok{\textquotesingle{}seagreen\textquotesingle{}}\NormalTok{).encode(}
\NormalTok{    x}\OperatorTok{=}\NormalTok{alt.X(}\StringTok{\textquotesingle{}Year:O\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{\textquotesingle{}Year\textquotesingle{}}\NormalTok{),}
\NormalTok{    y}\OperatorTok{=}\NormalTok{alt.Y(}\StringTok{\textquotesingle{}UniqueCount:Q\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{\textquotesingle{}Number of Unique Short{-}Term Hospitals\textquotesingle{}}\NormalTok{)}
\NormalTok{).properties(}
\NormalTok{    title}\OperatorTok{=}\StringTok{\textquotesingle{}Number of Unique Short{-}Term Hospitals in Dataset by Year\textquotesingle{}}\NormalTok{,}
\NormalTok{    width}\OperatorTok{=}\DecValTok{400}\NormalTok{,}
\NormalTok{    height}\OperatorTok{=}\DecValTok{300}
\NormalTok{)}

\CommentTok{\# Add text labels on top of each bar}
\NormalTok{text }\OperatorTok{=}\NormalTok{ bars.mark\_text(}
\NormalTok{    align}\OperatorTok{=}\StringTok{\textquotesingle{}center\textquotesingle{}}\NormalTok{,}
\NormalTok{    baseline}\OperatorTok{=}\StringTok{\textquotesingle{}bottom\textquotesingle{}}\NormalTok{,}
\NormalTok{    dy}\OperatorTok{={-}}\DecValTok{5}  \CommentTok{\# Adjust the position of the text above the bars}
\NormalTok{).encode(}
\NormalTok{    text}\OperatorTok{=}\StringTok{\textquotesingle{}UniqueCount:Q\textquotesingle{}}
\NormalTok{)}

\CommentTok{\# Display the combined chart with bars and labels}
\NormalTok{(bars }\OperatorTok{+}\NormalTok{ text).display()}


\CommentTok{\# Double checking for duplicates}
\CommentTok{\# Check for duplicates in PRVDR\_NUM within each year}
\NormalTok{duplicates\_2016 }\OperatorTok{=}\NormalTok{ data\_2016.duplicated(subset}\OperatorTok{=}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{).}\BuiltInTok{sum}\NormalTok{()}
\NormalTok{duplicates\_2017 }\OperatorTok{=}\NormalTok{ data\_2017.duplicated(subset}\OperatorTok{=}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{).}\BuiltInTok{sum}\NormalTok{()}
\NormalTok{duplicates\_2018 }\OperatorTok{=}\NormalTok{ data\_2018.duplicated(subset}\OperatorTok{=}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{).}\BuiltInTok{sum}\NormalTok{()}
\NormalTok{duplicates\_2019 }\OperatorTok{=}\NormalTok{ data\_2019.duplicated(subset}\OperatorTok{=}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{).}\BuiltInTok{sum}\NormalTok{()}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"2016 Duplicates: }\SpecialCharTok{\{}\NormalTok{duplicates\_2016}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"2017 Duplicates: }\SpecialCharTok{\{}\NormalTok{duplicates\_2017}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"2018 Duplicates: }\SpecialCharTok{\{}\NormalTok{duplicates\_2018}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"2019 Duplicates: }\SpecialCharTok{\{}\NormalTok{duplicates\_2019}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
alt.LayerChart(...)
\end{verbatim}

\begin{verbatim}
2016 Duplicates: 0
2017 Duplicates: 0
2018 Duplicates: 0
2019 Duplicates: 0
\end{verbatim}

\begin{verbatim}
b.
\end{verbatim}

The identical values in both plots indicate that each short-term
hospital appears only once per year, with no duplicates. This structure
confirms that each hospital's CMS certification number is unique
annually, allowing for clear year-over-year tracking.

\subsection{Identify hospital closures in POS file (15 pts)
(*)}\label{identify-hospital-closures-in-pos-file-15-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Step 1: Filter active hospitals in each year}
\NormalTok{active\_2016 }\OperatorTok{=}\NormalTok{ data\_2016[data\_2016[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{active\_2017 }\OperatorTok{=}\NormalTok{ data\_2017[data\_2017[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{active\_2018 }\OperatorTok{=}\NormalTok{ data\_2018[data\_2018[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{active\_2019 }\OperatorTok{=}\NormalTok{ data\_2019[data\_2019[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{]}

\CommentTok{\# Step 2: Define function to check if provider is active in a given year}
\KeywordTok{def}\NormalTok{ provider\_in\_year(df, provider\_num):}
\NormalTok{    row }\OperatorTok{=}\NormalTok{ df[df[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{] }\OperatorTok{==}\NormalTok{ provider\_num]}
    \ControlFlowTok{return} \KeywordTok{not}\NormalTok{ row.empty }\KeywordTok{and}\NormalTok{ row[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{].values[}\DecValTok{0}\NormalTok{] }\OperatorTok{==} \DecValTok{0}

\CommentTok{\# Step 3: Determine closure year for each provider number}
\KeywordTok{def}\NormalTok{ determine\_closure\_year(provider\_num):}
    \ControlFlowTok{if} \KeywordTok{not}\NormalTok{ provider\_in\_year(active\_2017, provider\_num):}
        \ControlFlowTok{return} \DecValTok{2017}
    \ControlFlowTok{elif} \KeywordTok{not}\NormalTok{ provider\_in\_year(active\_2018, provider\_num):}
        \ControlFlowTok{return} \DecValTok{2018}
    \ControlFlowTok{elif} \KeywordTok{not}\NormalTok{ provider\_in\_year(active\_2019, provider\_num):}
        \ControlFlowTok{return} \DecValTok{2019}
    \ControlFlowTok{return} \VariableTok{None}

\CommentTok{\# Step 4: Apply closure detection on active hospitals in 2016}
\NormalTok{active\_2016\_only }\OperatorTok{=}\NormalTok{ active\_2016[active\_2016[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{]}
\NormalTok{active\_2016\_only[}\StringTok{\textquotesingle{}Year\_Closed\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ active\_2016\_only[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].}\BuiltInTok{apply}\NormalTok{(determine\_closure\_year)}

\CommentTok{\# Step 5: Filter out hospitals that have a closure year assigned}
\NormalTok{closed\_hospitals }\OperatorTok{=}\NormalTok{ active\_2016\_only.dropna(subset}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}Year\_Closed\textquotesingle{}}\NormalTok{]).reset\_index(drop}\OperatorTok{=}\VariableTok{True}\NormalTok{)}

\CommentTok{\# Output the result}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Number of suspected hospital closures: }\SpecialCharTok{\{}\BuiltInTok{len}\NormalTok{(closed\_hospitals)}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\NormalTok{closed\_hospitals[[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Year\_Closed\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Number of suspected hospital closures: 174
\end{verbatim}

\begin{longtable}[]{@{}llll@{}}
\toprule\noalign{}
& FAC\_NAME & ZIP\_CD & Year\_Closed \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
0 & WEDOWEE HOSPITAL & 36278.0 & 2019.0 \\
1 & GEORGIANA MEDICAL CENTER & 36033.0 & 2019.0 \\
2 & RMC JACKSONVILLE & 36265.0 & 2018.0 \\
3 & NORTH ALABAMA SPECIALITY HOSPITAL & 35611.0 & 2018.0 \\
4 & ABRAZO MARYVALE CAMPUS & 85031.0 & 2017.0 \\
... & ... & ... & ... \\
169 & LITTLE RIVER HEALTHCARE CAMERON HOSPITAL & 76520.0 & 2019.0 \\
170 & BAY AREA REGIONAL MEDICAL CENTER, LLC & 77598.0 & 2018.0 \\
171 & BAYLOR EMERGENCY MEDICAL CENTER & 75087.0 & 2019.0 \\
172 & CONTINUECARE HOSPITAL AT MEDICAL CENTER ODESSA & 79761.0 &
2017.0 \\
173 & TEXAS GENERAL HOSPITAL- VZRMC LP & 75140.0 & 2019.0 \\
\end{longtable}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sort the closed hospitals by facility name}
\NormalTok{sorted\_closed\_hospitals }\OperatorTok{=}\NormalTok{ closed\_hospitals.sort\_values(by}\OperatorTok{=}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{).reset\_index(drop}\OperatorTok{=}\VariableTok{True}\NormalTok{)}

\CommentTok{\# Display the names and year of suspected closure for the first 10 rows}
\NormalTok{sorted\_closed\_hospitals[[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Year\_Closed\textquotesingle{}}\NormalTok{]].head(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lll@{}}
\toprule\noalign{}
& FAC\_NAME & Year\_Closed \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
0 & ABRAZO MARYVALE CAMPUS & 2017.0 \\
1 & ADVENTIST MEDICAL CENTER - CENTRAL VALLEY & 2017.0 \\
2 & AFFINITY MEDICAL CENTER & 2018.0 \\
3 & ALBANY MEDICAL CENTER / SOUTH CLINICAL CAMPUS & 2017.0 \\
4 & ALLEGIANCE SPECIALTY HOSPITAL OF KILGORE & 2017.0 \\
5 & ALLIANCE LAIRD HOSPITAL & 2019.0 \\
6 & ALLIANCEHEALTH DEACONESS & 2019.0 \\
7 & ANNE BATES LEACH EYE HOSPITAL & 2019.0 \\
8 & ARKANSAS VALLEY REGIONAL MEDICAL CENTER & 2017.0 \\
9 & BANNER CHURCHILL COMMUNITY HOSPITAL & 2017.0 \\
\end{longtable}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \end{enumerate}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Count active hospitals by ZIP code for each year}
\NormalTok{active\_by\_zip\_2016 }\OperatorTok{=}\NormalTok{ active\_2016[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].value\_counts().to\_dict()}
\NormalTok{active\_by\_zip\_2017 }\OperatorTok{=}\NormalTok{ active\_2017[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].value\_counts().to\_dict()}
\NormalTok{active\_by\_zip\_2018 }\OperatorTok{=}\NormalTok{ active\_2018[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].value\_counts().to\_dict()}
\NormalTok{active\_by\_zip\_2019 }\OperatorTok{=}\NormalTok{ active\_2019[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].value\_counts().to\_dict()}

\CommentTok{\# Define function to check if closure might be due to merger/acquisition}
\KeywordTok{def}\NormalTok{ is\_possible\_merger(row):}
\NormalTok{    zip\_code }\OperatorTok{=}\NormalTok{ row[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{]}
\NormalTok{    year\_closed }\OperatorTok{=}\NormalTok{ row[}\StringTok{\textquotesingle{}Year\_Closed\textquotesingle{}}\NormalTok{]}
    
    \ControlFlowTok{if}\NormalTok{ year\_closed }\OperatorTok{==} \DecValTok{2017}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ active\_by\_zip\_2017.get(zip\_code, }\DecValTok{0}\NormalTok{) }\OperatorTok{\textgreater{}=}\NormalTok{ active\_by\_zip\_2016.get(zip\_code, }\DecValTok{0}\NormalTok{)}
    \ControlFlowTok{elif}\NormalTok{ year\_closed }\OperatorTok{==} \DecValTok{2018}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ active\_by\_zip\_2018.get(zip\_code, }\DecValTok{0}\NormalTok{) }\OperatorTok{\textgreater{}=}\NormalTok{ active\_by\_zip\_2017.get(zip\_code, }\DecValTok{0}\NormalTok{)}
    \ControlFlowTok{elif}\NormalTok{ year\_closed }\OperatorTok{==} \DecValTok{2019}\NormalTok{:}
        \ControlFlowTok{return}\NormalTok{ active\_by\_zip\_2019.get(zip\_code, }\DecValTok{0}\NormalTok{) }\OperatorTok{\textgreater{}=}\NormalTok{ active\_by\_zip\_2018.get(zip\_code, }\DecValTok{0}\NormalTok{)}
    \ControlFlowTok{return} \VariableTok{False}

\CommentTok{\# Apply function to identify potential mergers/acquisitions}
\NormalTok{closed\_hospitals[}\StringTok{\textquotesingle{}Possible\_Merger\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ closed\_hospitals.}\BuiltInTok{apply}\NormalTok{(is\_possible\_merger, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}

\CommentTok{\# Filter suspected closures that might be due to a merger/acquisition}
\NormalTok{potential\_mergers }\OperatorTok{=}\NormalTok{ closed\_hospitals[closed\_hospitals[}\StringTok{\textquotesingle{}Possible\_Merger\textquotesingle{}}\NormalTok{]]}

\CommentTok{\# Output the result}
\NormalTok{num\_potential\_mergers }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(potential\_mergers)}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f"Number of suspected hospital closures that fit the merger/acquisition definition: }\SpecialCharTok{\{}\NormalTok{num\_potential\_mergers}\SpecialCharTok{\}}\SpecialStringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Number of suspected hospital closures that fit the merger/acquisition definition: 8
\end{verbatim}

\begin{verbatim}
b.
c.
\end{verbatim}

\subsection{Download Census zip code shapefile (10
pt)}\label{download-census-zip-code-shapefile-10-pt}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \end{enumerate}
\item
\end{enumerate}

\subsection{Calculate zip code's distance to the nearest hospital (20
pts)
(*)}\label{calculate-zip-codes-distance-to-the-nearest-hospital-20-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
\item
\item
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \end{enumerate}
\item
  \begin{enumerate}
  \def\labelenumii{\alph{enumii}.}
  \tightlist
  \item
  \item
  \item
  \end{enumerate}
\end{enumerate}

\subsection{Effects of closures on access in Texas (15
pts)}\label{effects-of-closures-on-access-in-texas-15-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
\item
\item
\item
\end{enumerate}

\subsection{Reflecting on the exercise (10
pts)}\label{reflecting-on-the-exercise-10-pts}




\end{document}
